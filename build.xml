<project name="ScalaCheck" basedir="." default="build">

  <!-- Global properties -->

  <property environment="env"/>
  <property name="scala.home" value="${env.SCALA_HOME}"/>

  <path id="scala.classpath">
    <pathelement location="${scala.home}/lib/scala-compiler.jar"/>
    <pathelement location="${scala.home}/lib/scala-library.jar"/>
  </path>

  <path id="svnant.classpath">
    <pathelement location="support/svnant/svnant.jar"/>
    <pathelement location="support/svnant/svnClientAdapter.jar"/>
    <pathelement location="support/svnant/svnjavahl.jar"/>
  </path>

  <typedef resource="org/tigris/subversion/svnant/svnantlib.xml"
           classpathref="svnant.classpath"/>
  <taskdef resource="scala/tools/ant/antlib.xml"
           classpathref="scala.classpath"/>

  <svn>
    <wcVersion path="."/>
  </svn>



  <!-- Project properties -->

  <property name="name"          value="${ant.project.name}"/>
  <property name="version.nr"    value="1.0"/>
  <property name="version"       value="${version.nr}dev-r${revision.max-with-flags}"/>
  <property name="author"        value="Rickard Nilsson"/>
  <property name="package.root"  value="scalacheck"/>
  <property name="src"           value="src"/>
  <property name="test"          value="test"/>
  <property name="build"         value="build"/>
  <property name="build.doc"     value="${build}/doc"/>
  <property name="build.doc.api" value="${build.doc}/api"/>
  <property name="build.pkg"     value="${build}/pkg"/>
  <property name="build.pkg.lib" value="${build.pkg}/lib"/>
  <property name="dist"          value="dist"/>



  <!-- External libs -->

  <property name="scala-library.jar" value="${scala.home}/lib/scala-library.jar" />



  <!-- Classpaths -->

  <path id="build.classpath">
    <pathelement location="${scala-library.jar}"/>
  </path>

  <path id="run.classpath">
    <path refid="build.classpath"/>
    <pathelement location="${build}"/>
  </path>



  <!-- Targets -->

  <target name="prepare">
    <mkdir dir="${build}"/>
    <mkdir dir="${dist}"/>
    <mkdir dir="${build.doc}"/>
    <mkdir dir="${build.doc.api}"/>
    <mkdir dir="${build.pkg}"/>
    <mkdir dir="${build.pkg.lib}"/>
  </target>


  <target name="clean">
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>


  <target name="build" depends="prepare">

    <scalac srcdir="${src}"
            destdir="${build}"
            classpathref="build.classpath"/>

    <scalac srcdir="${test}"
            destdir="${build}"
            classpathref="build.classpath"/>

  </target>


  <target name="doc" depends="prepare">

    <copy todir="${build.doc}">
      <fileset dir=".">
        <include name="LICENSE"/>
        <include name="RELEASE"/>
      </fileset>
    </copy>

    <scaladoc
      srcdir="${src}"
      destdir="${build.doc.api}"
      windowtitle="${name} ${version}"
      doctitle="${name} ${version}"
      addparams="-linksource"
      classpathref="run.classpath">
      <include name="**/*.scala"/>
    </scaladoc>

  </target>


  <target name="jar" depends="clean,build,doc">

    <jar destfile="${dist}/${name}-${version}.jar">
      <fileset dir="${build}">
        <include name="${package.root}/**"/>
        <exclude name="doc/**"/>
        <exclude name="test/**"/>
      </fileset>
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <attribute name="Export-Package" value='${package.root};version="${version}"'/>
        <section name="${package.root}">
          <attribute name="Specification-Title"    value="${name}"/>
          <attribute name="Specification-Version"  value="${version}"/>
          <attribute name="Specification-Vendor"   value="${author}"/>
          <attribute name="Implementation-Title"   value="${package.root}"/>
          <attribute name="Implementation-Version" value="${version}"/>
          <attribute name="Implementation-Vendor"  value="${author}"/>
        </section>
      </manifest>
    </jar>

  </target>


  <target name="dist" depends="jar">

    <copy file="${dist}/${name}-${version}.jar" todir="${build.pkg.lib}"/>

    <exec executable="sbaz" failonerror="true">
      <arg value="pack"/>
      <arg value="scalacheck"/>
      <arg value="${build.pkg}"/>
      <arg value="--version"/>
      <arg value="${version}"/>
      <arg value="--outdir"/>
      <arg value="${dist}"/>
      <arg value="--linkbase"/>
      <arg value="http://scalacheck.googlecode.com/files/"/>
      <arg value="--description"/>
      <arg value='ScalaCheck is a library for property-based, randomized testing of Scala programs. It is a Scala implementation of the QuickCheck Haskell library'/>
    </exec>

    <move file="scalacheck-${version}.advert" todir="${dist}"/>

  </target>


  <target name="dist-release">

    <antcall target="dist">
      <param name="version" value="${version.nr}"/>
    </antcall>

  </target>


  <target name="install" depends="dist">

    <exec executable="sbaz" failonerror="true">
      <arg value="install"/>
      <arg value="-f"/>
      <arg value="${dist}/scalacheck-${version}.sbp"/>
    </exec>

  </target>

</project>
